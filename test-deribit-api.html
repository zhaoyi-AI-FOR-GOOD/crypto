<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deribit API æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #000; color: #fff; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #1a5d1a; }
        .error { background: #5d1a1a; }
        .info { background: #1a1a5d; }
        .data { background: #333; max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Deribit API è¿æ¥æµ‹è¯•</h1>
    <button onclick="testDeribitAPI()">æµ‹è¯• Deribit API</button>
    <div id="results"></div>

    <script>
        async function testDeribitAPI() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="info test-result">å¼€å§‹æµ‹è¯• Deribit API...</div>';
            
            try {
                // æµ‹è¯•1: è·å–BTCä»·æ ¼
                resultsDiv.innerHTML += '<div class="info test-result">æµ‹è¯•1: è·å–BTCæ°¸ç»­åˆçº¦ä»·æ ¼...</div>';
                const btcResponse = await fetch('https://www.deribit.com/api/v2/public/ticker?instrument_name=BTC-PERPETUAL');
                
                if (btcResponse.ok) {
                    const btcData = await btcResponse.json();
                    resultsDiv.innerHTML += `<div class="success test-result">âœ“ BTCä»·æ ¼è·å–æˆåŠŸ: $${btcData.result.last_price}</div>`;
                    
                    // æµ‹è¯•2: è·å–æœŸæƒåˆçº¦åˆ—è¡¨
                    resultsDiv.innerHTML += '<div class="info test-result">æµ‹è¯•2: è·å–BTCæœŸæƒåˆçº¦...</div>';
                    const optionsResponse = await fetch('https://www.deribit.com/api/v2/public/get_instruments?currency=BTC&kind=option&expired=false');
                    
                    if (optionsResponse.ok) {
                        const optionsData = await optionsResponse.json();
                        const options = optionsData.result.slice(0, 5); // åªæ˜¾ç¤ºå‰5ä¸ª
                        resultsDiv.innerHTML += `<div class="success test-result">âœ“ æœŸæƒåˆçº¦è·å–æˆåŠŸ: å…±${optionsData.result.length}ä¸ªåˆçº¦</div>`;
                        resultsDiv.innerHTML += `<div class="data test-result">å‰5ä¸ªåˆçº¦: <pre>${JSON.stringify(options.map(o => o.instrument_name), null, 2)}</pre></div>`;
                        
                        // æµ‹è¯•3: è·å–æœŸæƒæŠ¥ä»·
                        resultsDiv.innerHTML += '<div class="info test-result">æµ‹è¯•3: è·å–æœŸæƒå¸‚åœºæŠ¥ä»·...</div>';
                        const bookResponse = await fetch('https://www.deribit.com/api/v2/public/get_book_summary_by_currency?currency=BTC&kind=option');
                        
                        if (bookResponse.ok) {
                            const bookData = await bookResponse.json();
                            const validQuotes = bookData.result.filter(q => q.bid_price > 0 && q.ask_price > 0).slice(0, 3);
                            resultsDiv.innerHTML += `<div class="success test-result">âœ“ æœŸæƒæŠ¥ä»·è·å–æˆåŠŸ: æœ‰æ•ˆæŠ¥ä»·${validQuotes.length}ä¸ª</div>`;
                            resultsDiv.innerHTML += `<div class="data test-result">ç¤ºä¾‹æŠ¥ä»·: <pre>${JSON.stringify(validQuotes.map(q => ({
                                instrument: q.instrument_name,
                                bid: q.bid_price,
                                ask: q.ask_price,
                                volume: q.volume
                            })), null, 2)}</pre></div>`;
                            
                            resultsDiv.innerHTML += '<div class="success test-result">ğŸ‰ æ‰€æœ‰APIæµ‹è¯•é€šè¿‡ï¼ç°åœ¨å¯ä»¥ä½¿ç”¨çœŸå®æ•°æ®è¿›è¡Œå¥—åˆ©æ‰«æã€‚</div>';
                        } else {
                            throw new Error('æœŸæƒæŠ¥ä»·APIè°ƒç”¨å¤±è´¥');
                        }
                    } else {
                        throw new Error('æœŸæƒåˆçº¦APIè°ƒç”¨å¤±è´¥');
                    }
                } else {
                    throw new Error('BTCä»·æ ¼APIè°ƒç”¨å¤±è´¥');
                }
            } catch (error) {
                resultsDiv.innerHTML += `<div class="error test-result">âŒ APIæµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                console.error('APIæµ‹è¯•é”™è¯¯:', error);
            }
        }
    </script>
</body>
</html>