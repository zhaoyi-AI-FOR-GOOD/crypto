<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥—åˆ©æ•°æ®è°ƒè¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #000; color: #fff; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #333; border-radius: 5px; }
        .debug-title { color: #00CFBE; font-weight: bold; margin-bottom: 10px; }
        .data { background: #111; padding: 10px; border-radius: 3px; font-family: monospace; font-size: 12px; white-space: pre-wrap; }
        .error { color: #ff4444; }
        .success { color: #44ff44; }
        .warning { color: #ffaa44; }
    </style>
</head>
<body>
    <h1>å¥—åˆ©æ•°æ®è§£æè°ƒè¯•</h1>
    <button onclick="debugArbitrageData()" style="padding: 10px 20px; background: #00CFBE; color: #000; border: none; border-radius: 5px; cursor: pointer;">å¼€å§‹è°ƒè¯•</button>
    
    <div id="debug-results"></div>

    <script>
        async function debugArbitrageData() {
            const resultsDiv = document.getElementById('debug-results');
            resultsDiv.innerHTML = '<div class="debug-section"><div class="debug-title">å¼€å§‹è°ƒè¯•å¥—åˆ©æ•°æ®è§£æ...</div></div>';
            
            try {
                // æµ‹è¯•1: è·å–BTCä»·æ ¼
                resultsDiv.innerHTML += '<div class="debug-section"><div class="debug-title">æ­¥éª¤1: è·å–BTCç°è´§ä»·æ ¼</div><div class="data">æ­£åœ¨è·å–...</div></div>';
                
                const btcResponse = await fetch('https://www.deribit.com/api/v2/public/ticker?instrument_name=BTC-PERPETUAL');
                const btcData = await btcResponse.json();
                const btcPrice = btcData.result.last_price;
                
                resultsDiv.innerHTML += `<div class="debug-section"><div class="debug-title success">âœ“ BTCä»·æ ¼è·å–æˆåŠŸ</div><div class="data">å½“å‰ä»·æ ¼: $${btcPrice}</div></div>`;
                
                // æµ‹è¯•2: è·å–æœŸæƒåˆçº¦ä¿¡æ¯
                resultsDiv.innerHTML += '<div class="debug-section"><div class="debug-title">æ­¥éª¤2: è·å–æœŸæƒåˆçº¦ä¿¡æ¯</div><div class="data">æ­£åœ¨è·å–...</div></div>';
                
                const instrumentsResponse = await fetch('https://www.deribit.com/api/v2/public/get_instruments?currency=BTC&kind=option&expired=false');
                const instrumentsData = await instrumentsResponse.json();
                const instruments = instrumentsData.result.slice(0, 5); // åªçœ‹å‰5ä¸ª
                
                resultsDiv.innerHTML += `<div class="debug-section"><div class="debug-title success">âœ“ æœŸæƒåˆçº¦ä¿¡æ¯</div><div class="data">æ€»åˆçº¦æ•°: ${instrumentsData.result.length}

å‰5ä¸ªåˆçº¦:
${instruments.map(inst => `
åˆçº¦åç§°: ${inst.instrument_name}
è¡Œæƒä»·: ${inst.strike}
æœŸæƒç±»å‹: ${inst.option_type}
åˆ°æœŸæ—¶é—´æˆ³: ${inst.expiration_timestamp}
åˆ°æœŸæ—¥æœŸ: ${new Date(inst.expiration_timestamp).toLocaleDateString()}
`).join('\n---\n')}</div></div>`;
                
                // æµ‹è¯•3: è·å–æœŸæƒå¸‚åœºæ•°æ®
                resultsDiv.innerHTML += '<div class="debug-section"><div class="debug-title">æ­¥éª¤3: è·å–æœŸæƒå¸‚åœºæ•°æ®</div><div class="data">æ­£åœ¨è·å–...</div></div>';
                
                const bookResponse = await fetch('https://www.deribit.com/api/v2/public/get_book_summary_by_currency?currency=BTC&kind=option');
                const bookData = await bookResponse.json();
                const validQuotes = bookData.result.filter(q => 
                    q.bid_price > 0 && 
                    q.ask_price > 0 && 
                    q.bid_price < q.ask_price &&
                    q.instrument_name.includes('-C')  // åªçœ‹CallæœŸæƒ
                ).slice(0, 3);
                
                resultsDiv.innerHTML += `<div class="debug-section"><div class="debug-title success">âœ“ æœŸæƒå¸‚åœºæ•°æ®</div><div class="data">æœ‰æ•ˆæŠ¥ä»·æ€»æ•°: ${bookData.result.filter(q => q.bid_price > 0 && q.ask_price > 0).length}

ç¤ºä¾‹CallæœŸæƒæŠ¥ä»·:
${validQuotes.map(q => `
åˆçº¦: ${q.instrument_name}
ä¹°ä»·: ${q.bid_price}
å–ä»·: ${q.ask_price}
æˆäº¤é‡: ${q.volume || 0}
æŒä»“é‡: ${q.open_interest || 0}
éšå«æ³¢åŠ¨ç‡: ${q.mark_iv || 0}%
Delta: ${q.greeks?.delta || 'N/A'}
`).join('\n---\n')}</div></div>`;
                
                // æµ‹è¯•4: æ¨¡æ‹Ÿå¥—åˆ©è®¡ç®—
                resultsDiv.innerHTML += '<div class="debug-section"><div class="debug-title">æ­¥éª¤4: æ¨¡æ‹Ÿå¥—åˆ©è®¡ç®—</div><div class="data">æ­£åœ¨è®¡ç®—...</div></div>';
                
                // æ‰¾ä¸€å¯¹ç›¸åŒè¡Œæƒä»·çš„Callå’ŒPut
                const sampleStrike = instruments[0].strike;
                const sampleExpiry = instruments[0].instrument_name.split('-')[1];
                
                const callName = `BTC-${sampleExpiry}-${sampleStrike}-C`;
                const putName = `BTC-${sampleExpiry}-${sampleStrike}-P`;
                
                const callQuote = bookData.result.find(q => q.instrument_name === callName);
                const putQuote = bookData.result.find(q => q.instrument_name === putName);
                
                if (callQuote && putQuote && callQuote.bid_price > 0 && putQuote.ask_price > 0) {
                    // è½¬æ¢å¥—åˆ©è®¡ç®—
                    const stockCost = btcPrice;
                    const putCost = putQuote.ask_price;
                    const callIncome = callQuote.bid_price;
                    const transactionCosts = 6; // 3ç¬”äº¤æ˜“ * $2
                    
                    const initialInvestment = stockCost + putCost - callIncome + transactionCosts;
                    const maturityValue = sampleStrike;
                    const profit = maturityValue - initialInvestment;
                    const profitPercent = initialInvestment > 0 ? (profit / initialInvestment) * 100 : 0;
                    
                    // è®¡ç®—åˆ°æœŸå¤©æ•°
                    const expiryDate = new Date(instruments[0].expiration_timestamp);
                    const today = new Date();
                    const daysToExpiry = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
                    
                    resultsDiv.innerHTML += `<div class="debug-section"><div class="debug-title ${profit > 0 ? 'success' : 'warning'}">å¥—åˆ©è®¡ç®—ç»“æœ</div><div class="data">è½¬æ¢å¥—åˆ©ç¤ºä¾‹:
è¡Œæƒä»·: $${sampleStrike}
åˆ°æœŸå¤©æ•°: ${daysToExpiry}å¤©

æˆæœ¬åˆ†è§£:
- ä¹°å…¥BTCç°è´§: $${stockCost}
- ä¹°å…¥PutæœŸæƒ: $${putCost}
- å–å‡ºCallæœŸæƒ: -$${callIncome}
- äº¤æ˜“è´¹ç”¨: $${transactionCosts}
æ€»æŠ•èµ„: $${initialInvestment.toFixed(2)}

åˆ°æœŸæ”¶ç›Š:
- å›ºå®šæ”¶ç›Š: $${maturityValue}
- å‡€åˆ©æ¶¦: $${profit.toFixed(2)}
- åˆ©æ¶¦ç‡: ${profitPercent.toFixed(2)}%

${profit > 10 ? 'âœ“ å­˜åœ¨å¥—åˆ©æœºä¼š!' : profit > 0 ? '? å¾®å°å¥—åˆ©æœºä¼š' : 'âœ— æ— å¥—åˆ©æœºä¼š'}</div></div>`;
                } else {
                    resultsDiv.innerHTML += `<div class="debug-section"><div class="debug-title warning">âš  å¥—åˆ©è®¡ç®—</div><div class="data">æœªæ‰¾åˆ°åŒ¹é…çš„Call/Putå¯¹:
å¯»æ‰¾çš„åˆçº¦: ${callName}, ${putName}
CallæŠ¥ä»·: ${callQuote ? 'æ‰¾åˆ°' : 'æœªæ‰¾åˆ°'}
PutæŠ¥ä»·: ${putQuote ? 'æ‰¾åˆ°' : 'æœªæ‰¾åˆ°'}</div></div>`;
                }
                
                resultsDiv.innerHTML += '<div class="debug-section"><div class="debug-title success">ğŸ‰ è°ƒè¯•å®Œæˆï¼æ•°æ®è§£ææ­£ç¡®ï¼Œå¯ä»¥è¿›è¡ŒçœŸå®å¥—åˆ©æ‰«æã€‚</div></div>';
                
            } catch (error) {
                resultsDiv.innerHTML += `<div class="debug-section"><div class="debug-title error">âŒ è°ƒè¯•å¤±è´¥</div><div class="data">${error.message}\n\n${error.stack}</div></div>`;
            }
        }
    </script>
</body>
</html>