class CoinDiscovery {\n    constructor() {\n        this.discoveryFilter = 'new';\n        this.setupEventListeners();\n    }\n\n    setupEventListeners() {\n        const filterSelect = document.getElementById('discovery-filter');\n        if (filterSelect) {\n            filterSelect.addEventListener('change', (e) => {\n                this.discoveryFilter = e.target.value;\n                this.loadDiscoveryData();\n            });\n        }\n    }\n\n    async loadDiscoveryData() {\n        try {\n            switch (this.discoveryFilter) {\n                case 'new':\n                    await this.loadNewCoins();\n                    break;\n                case 'volume':\n                    await this.loadVolumeGainers();\n                    break;\n                case 'price':\n                    await this.loadPriceMovers();\n                    break;\n                default:\n                    await this.loadNewCoins();\n            }\n        } catch (error) {\n            console.error('加载新币发现数据失败:', error);\n            this.showDiscoveryError();\n        }\n    }\n\n    async loadNewCoins() {\n        try {\n            // 获取最新添加的代币\n            const response = await fetch(\n                'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=id_asc&per_page=20&page=1&sparkline=false&price_change_percentage=24h'\n            );\n\n            if (!response.ok) {\n                throw new Error('Failed to fetch new coins');\n            }\n\n            const coins = await response.json();\n            this.renderDiscoveryResults(coins, '🔍 最新上市代币');\n\n        } catch (error) {\n            console.error('加载新币数据失败:', error);\n            this.renderMockDiscoveryData();\n        }\n    }\n\n    async loadVolumeGainers() {\n        try {\n            // 获取交易量激增的代币\n            const response = await fetch(\n                'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=volume_desc&per_page=20&page=1&sparkline=false&price_change_percentage=24h'\n            );\n\n            if (!response.ok) {\n                throw new Error('Failed to fetch volume gainers');\n            }\n\n            const coins = await response.json();\n            this.renderDiscoveryResults(coins, '📊 交易量激增代币');\n\n        } catch (error) {\n            console.error('加载交易量数据失败:', error);\n            this.renderMockDiscoveryData();\n        }\n    }\n\n    async loadPriceMovers() {\n        try {\n            // 获取价格异动的代币\n            const response = await fetch(\n                'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=percent_change_24h_desc&per_page=20&page=1&sparkline=false&price_change_percentage=24h'\n            );\n\n            if (!response.ok) {\n                throw new Error('Failed to fetch price movers');\n            }\n\n            const coins = await response.json();\n            this.renderDiscoveryResults(coins, '🚀 价格异动代币');\n\n        } catch (error) {\n            console.error('加载价格异动数据失败:', error);\n            this.renderMockDiscoveryData();\n        }\n    }\n\n    renderDiscoveryResults(coins, title) {\n        const container = document.getElementById('new-coins-list');\n        \n        container.innerHTML = `\n            <div class=\"discovery-header\">\n                <h4>${title}</h4>\n                <p>发现潜在的投资机会</p>\n            </div>\n            <div class=\"discovery-grid\">\n                ${coins.slice(0, 12).map(coin => this.createDiscoveryCard(coin)).join('')}\n            </div>\n        `;\n    }\n\n    createDiscoveryCard(coin) {\n        const priceChange = coin.price_change_percentage_24h || 0;\n        const changeClass = priceChange >= 0 ? 'change-positive' : 'change-negative';\n        const changeIcon = priceChange >= 0 ? '📈' : '📉';\n        \n        // 计算风险等级\n        const riskLevel = this.calculateRiskLevel(coin);\n        const riskColor = this.getRiskColor(riskLevel);\n        \n        return `\n            <div class=\"discovery-card\">\n                <div class=\"discovery-header-info\">\n                    <img src=\"${coin.image}\" alt=\"${coin.name}\" class=\"discovery-icon\">\n                    <div class=\"discovery-info\">\n                        <div class=\"discovery-name\">${coin.name}</div>\n                        <div class=\"discovery-symbol\">${coin.symbol.toUpperCase()}</div>\n                    </div>\n                    <div class=\"risk-badge\" style=\"background: ${riskColor}\">\n                        ${riskLevel}\n                    </div>\n                </div>\n                \n                <div class=\"discovery-price\">\n                    <div class=\"current-price\">$${this.formatPrice(coin.current_price)}</div>\n                    <div class=\"price-change ${changeClass}\">\n                        ${changeIcon} ${priceChange.toFixed(2)}%\n                    </div>\n                </div>\n                \n                <div class=\"discovery-metrics\">\n                    <div class=\"metric\">\n                        <span class=\"metric-label\">市值排名</span>\n                        <span class=\"metric-value\">#${coin.market_cap_rank || 'N/A'}</span>\n                    </div>\n                    <div class=\"metric\">\n                        <span class=\"metric-label\">24h成交量</span>\n                        <span class=\"metric-value\">$${this.formatMarketCap(coin.total_volume)}</span>\n                    </div>\n                    <div class=\"metric\">\n                        <span class=\"metric-label\">市值</span>\n                        <span class=\"metric-value\">$${this.formatMarketCap(coin.market_cap)}</span>\n                    </div>\n                </div>\n                \n                <div class=\"discovery-analysis\">\n                    ${this.generateAnalysis(coin)}\n                </div>\n            </div>\n        `;\n    }\n\n    calculateRiskLevel(coin) {\n        const marketCapRank = coin.market_cap_rank || 999;\n        const priceChange = Math.abs(coin.price_change_percentage_24h || 0);\n        \n        if (marketCapRank <= 100 && priceChange < 10) return '低风险';\n        if (marketCapRank <= 300 && priceChange < 20) return '中风险';\n        return '高风险';\n    }\n\n    getRiskColor(riskLevel) {\n        switch (riskLevel) {\n            case '低风险': return '#4CAF50';\n            case '中风险': return '#FF9800';\n            case '高风险': return '#f44336';\n            default: return '#9E9E9E';\n        }\n    }\n\n    generateAnalysis(coin) {\n        const analyses = [];\n        \n        const priceChange = coin.price_change_percentage_24h || 0;\n        if (priceChange > 20) {\n            analyses.push('🔥 价格大幅上涨');\n        } else if (priceChange < -20) {\n            analyses.push('⚠️ 价格大幅下跌');\n        }\n        \n        if (coin.market_cap_rank && coin.market_cap_rank <= 100) {\n            analyses.push('⭐ 主流代币');\n        } else if (!coin.market_cap_rank || coin.market_cap_rank > 500) {\n            analyses.push('🚀 新兴项目');\n        }\n        \n        if (coin.total_volume > coin.market_cap * 0.1) {\n            analyses.push('📊 高流动性');\n        }\n        \n        return analyses.length > 0 ? \n            `<div class=\"analysis-tags\">${analyses.map(tag => `<span class=\"analysis-tag\">${tag}</span>`).join('')}</div>` : \n            '<div class=\"analysis-tags\"><span class=\"analysis-tag\">📈 观察中</span></div>';\n    }\n\n    renderMockDiscoveryData() {\n        const container = document.getElementById('new-coins-list');\n        \n        const mockCoins = [\n            {\n                name: 'DeFi Protocol X',\n                symbol: 'DPX',\n                price: '$0.045',\n                change: '+145.2%',\n                risk: '高风险',\n                analysis: ['🔥 价格大幅上涨', '🚀 新兴项目']\n            },\n            {\n                name: 'AI Chain Token',\n                symbol: 'AIC',\n                price: '$1.23',\n                change: '+67.8%',\n                risk: '中风险',\n                analysis: ['🔥 价格大幅上涨', '📊 高流动性']\n            },\n            {\n                name: 'MetaWorld Coin',\n                symbol: 'MWC',\n                price: '$0.0089',\n                change: '+234.5%',\n                risk: '高风险',\n                analysis: ['🔥 价格大幅上涨', '🚀 新兴项目']\n            }\n        ];\n\n        container.innerHTML = `\n            <div class=\"discovery-header\">\n                <h4>🔍 发现新机会 (模拟数据)</h4>\n                <p>早期发现具有潜力的投资机会</p>\n            </div>\n            <div class=\"discovery-grid\">\n                ${mockCoins.map(coin => `\n                    <div class=\"discovery-card mock\">\n                        <div class=\"discovery-header-info\">\n                            <div class=\"discovery-icon-placeholder\">🪙</div>\n                            <div class=\"discovery-info\">\n                                <div class=\"discovery-name\">${coin.name}</div>\n                                <div class=\"discovery-symbol\">${coin.symbol}</div>\n                            </div>\n                            <div class=\"risk-badge\" style=\"background: ${this.getRiskColor(coin.risk)}\">\n                                ${coin.risk}\n                            </div>\n                        </div>\n                        \n                        <div class=\"discovery-price\">\n                            <div class=\"current-price\">${coin.price}</div>\n                            <div class=\"price-change change-positive\">\n                                📈 ${coin.change}\n                            </div>\n                        </div>\n                        \n                        <div class=\"discovery-analysis\">\n                            <div class=\"analysis-tags\">\n                                ${coin.analysis.map(tag => `<span class=\"analysis-tag\">${tag}</span>`).join('')}\n                            </div>\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            <div class=\"discovery-disclaimer\">\n                <p>⚠️ 投资有风险，入市需谨慎</p>\n                <p>请做好充分的研究再进行投资决策</p>\n            </div>\n        `;\n    }\n\n    showDiscoveryError() {\n        const container = document.getElementById('new-coins-list');\n        container.innerHTML = '<p style=\"text-align: center; color: #f44336; padding: 40px;\">🔍 加载新币发现数据失败</p>';\n    }\n\n    formatPrice(price) {\n        if (price < 0.01) {\n            return price.toFixed(6);\n        } else if (price < 1) {\n            return price.toFixed(4);\n        } else {\n            return price.toFixed(2);\n        }\n    }\n\n    formatMarketCap(marketCap) {\n        if (marketCap >= 1e9) {\n            return (marketCap / 1e9).toFixed(2) + 'B';\n        } else if (marketCap >= 1e6) {\n            return (marketCap / 1e6).toFixed(2) + 'M';\n        } else if (marketCap >= 1e3) {\n            return (marketCap / 1e3).toFixed(2) + 'K';\n        } else {\n            return marketCap.toString();\n        }\n    }\n}\n\n// 在页面加载时初始化\ndocument.addEventListener('DOMContentLoaded', () => {\n    window.coinDiscovery = new CoinDiscovery();\n});