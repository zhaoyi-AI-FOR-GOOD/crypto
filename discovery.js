class CoinDiscovery {\n    constructor() {\n        this.discoveryFilter = 'new';\n        this.setupEventListeners();\n    }\n\n    setupEventListeners() {\n        const filterSelect = document.getElementById('discovery-filter');\n        if (filterSelect) {\n            filterSelect.addEventListener('change', (e) => {\n                this.discoveryFilter = e.target.value;\n                this.loadDiscoveryData();\n            });\n        }\n    }\n\n    async loadDiscoveryData() {\n        try {\n            switch (this.discoveryFilter) {\n                case 'new':\n                    await this.loadNewCoins();\n                    break;\n                case 'volume':\n                    await this.loadVolumeGainers();\n                    break;\n                case 'price':\n                    await this.loadPriceMovers();\n                    break;\n                default:\n                    await this.loadNewCoins();\n            }\n        } catch (error) {\n            console.error('åŠ è½½æ–°å¸å‘ç°æ•°æ®å¤±è´¥:', error);\n            this.showDiscoveryError();\n        }\n    }\n\n    async loadNewCoins() {\n        try {\n            // è·å–æœ€æ–°æ·»åŠ çš„ä»£å¸\n            const response = await fetch(\n                'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=id_asc&per_page=20&page=1&sparkline=false&price_change_percentage=24h'\n            );\n\n            if (!response.ok) {\n                throw new Error('Failed to fetch new coins');\n            }\n\n            const coins = await response.json();\n            this.renderDiscoveryResults(coins, 'ğŸ” æœ€æ–°ä¸Šå¸‚ä»£å¸');\n\n        } catch (error) {\n            console.error('åŠ è½½æ–°å¸æ•°æ®å¤±è´¥:', error);\n            this.renderMockDiscoveryData();\n        }\n    }\n\n    async loadVolumeGainers() {\n        try {\n            // è·å–äº¤æ˜“é‡æ¿€å¢çš„ä»£å¸\n            const response = await fetch(\n                'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=volume_desc&per_page=20&page=1&sparkline=false&price_change_percentage=24h'\n            );\n\n            if (!response.ok) {\n                throw new Error('Failed to fetch volume gainers');\n            }\n\n            const coins = await response.json();\n            this.renderDiscoveryResults(coins, 'ğŸ“Š äº¤æ˜“é‡æ¿€å¢ä»£å¸');\n\n        } catch (error) {\n            console.error('åŠ è½½äº¤æ˜“é‡æ•°æ®å¤±è´¥:', error);\n            this.renderMockDiscoveryData();\n        }\n    }\n\n    async loadPriceMovers() {\n        try {\n            // è·å–ä»·æ ¼å¼‚åŠ¨çš„ä»£å¸\n            const response = await fetch(\n                'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=percent_change_24h_desc&per_page=20&page=1&sparkline=false&price_change_percentage=24h'\n            );\n\n            if (!response.ok) {\n                throw new Error('Failed to fetch price movers');\n            }\n\n            const coins = await response.json();\n            this.renderDiscoveryResults(coins, 'ğŸš€ ä»·æ ¼å¼‚åŠ¨ä»£å¸');\n\n        } catch (error) {\n            console.error('åŠ è½½ä»·æ ¼å¼‚åŠ¨æ•°æ®å¤±è´¥:', error);\n            this.renderMockDiscoveryData();\n        }\n    }\n\n    renderDiscoveryResults(coins, title) {\n        const container = document.getElementById('new-coins-list');\n        \n        container.innerHTML = `\n            <div class=\"discovery-header\">\n                <h4>${title}</h4>\n                <p>å‘ç°æ½œåœ¨çš„æŠ•èµ„æœºä¼š</p>\n            </div>\n            <div class=\"discovery-grid\">\n                ${coins.slice(0, 12).map(coin => this.createDiscoveryCard(coin)).join('')}\n            </div>\n        `;\n    }\n\n    createDiscoveryCard(coin) {\n        const priceChange = coin.price_change_percentage_24h || 0;\n        const changeClass = priceChange >= 0 ? 'change-positive' : 'change-negative';\n        const changeIcon = priceChange >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰';\n        \n        // è®¡ç®—é£é™©ç­‰çº§\n        const riskLevel = this.calculateRiskLevel(coin);\n        const riskColor = this.getRiskColor(riskLevel);\n        \n        return `\n            <div class=\"discovery-card\">\n                <div class=\"discovery-header-info\">\n                    <img src=\"${coin.image}\" alt=\"${coin.name}\" class=\"discovery-icon\">\n                    <div class=\"discovery-info\">\n                        <div class=\"discovery-name\">${coin.name}</div>\n                        <div class=\"discovery-symbol\">${coin.symbol.toUpperCase()}</div>\n                    </div>\n                    <div class=\"risk-badge\" style=\"background: ${riskColor}\">\n                        ${riskLevel}\n                    </div>\n                </div>\n                \n                <div class=\"discovery-price\">\n                    <div class=\"current-price\">$${this.formatPrice(coin.current_price)}</div>\n                    <div class=\"price-change ${changeClass}\">\n                        ${changeIcon} ${priceChange.toFixed(2)}%\n                    </div>\n                </div>\n                \n                <div class=\"discovery-metrics\">\n                    <div class=\"metric\">\n                        <span class=\"metric-label\">å¸‚å€¼æ’å</span>\n                        <span class=\"metric-value\">#${coin.market_cap_rank || 'N/A'}</span>\n                    </div>\n                    <div class=\"metric\">\n                        <span class=\"metric-label\">24hæˆäº¤é‡</span>\n                        <span class=\"metric-value\">$${this.formatMarketCap(coin.total_volume)}</span>\n                    </div>\n                    <div class=\"metric\">\n                        <span class=\"metric-label\">å¸‚å€¼</span>\n                        <span class=\"metric-value\">$${this.formatMarketCap(coin.market_cap)}</span>\n                    </div>\n                </div>\n                \n                <div class=\"discovery-analysis\">\n                    ${this.generateAnalysis(coin)}\n                </div>\n            </div>\n        `;\n    }\n\n    calculateRiskLevel(coin) {\n        const marketCapRank = coin.market_cap_rank || 999;\n        const priceChange = Math.abs(coin.price_change_percentage_24h || 0);\n        \n        if (marketCapRank <= 100 && priceChange < 10) return 'ä½é£é™©';\n        if (marketCapRank <= 300 && priceChange < 20) return 'ä¸­é£é™©';\n        return 'é«˜é£é™©';\n    }\n\n    getRiskColor(riskLevel) {\n        switch (riskLevel) {\n            case 'ä½é£é™©': return '#4CAF50';\n            case 'ä¸­é£é™©': return '#FF9800';\n            case 'é«˜é£é™©': return '#f44336';\n            default: return '#9E9E9E';\n        }\n    }\n\n    generateAnalysis(coin) {\n        const analyses = [];\n        \n        const priceChange = coin.price_change_percentage_24h || 0;\n        if (priceChange > 20) {\n            analyses.push('ğŸ”¥ ä»·æ ¼å¤§å¹…ä¸Šæ¶¨');\n        } else if (priceChange < -20) {\n            analyses.push('âš ï¸ ä»·æ ¼å¤§å¹…ä¸‹è·Œ');\n        }\n        \n        if (coin.market_cap_rank && coin.market_cap_rank <= 100) {\n            analyses.push('â­ ä¸»æµä»£å¸');\n        } else if (!coin.market_cap_rank || coin.market_cap_rank > 500) {\n            analyses.push('ğŸš€ æ–°å…´é¡¹ç›®');\n        }\n        \n        if (coin.total_volume > coin.market_cap * 0.1) {\n            analyses.push('ğŸ“Š é«˜æµåŠ¨æ€§');\n        }\n        \n        return analyses.length > 0 ? \n            `<div class=\"analysis-tags\">${analyses.map(tag => `<span class=\"analysis-tag\">${tag}</span>`).join('')}</div>` : \n            '<div class=\"analysis-tags\"><span class=\"analysis-tag\">ğŸ“ˆ è§‚å¯Ÿä¸­</span></div>';\n    }\n\n    renderMockDiscoveryData() {\n        const container = document.getElementById('new-coins-list');\n        \n        const mockCoins = [\n            {\n                name: 'DeFi Protocol X',\n                symbol: 'DPX',\n                price: '$0.045',\n                change: '+145.2%',\n                risk: 'é«˜é£é™©',\n                analysis: ['ğŸ”¥ ä»·æ ¼å¤§å¹…ä¸Šæ¶¨', 'ğŸš€ æ–°å…´é¡¹ç›®']\n            },\n            {\n                name: 'AI Chain Token',\n                symbol: 'AIC',\n                price: '$1.23',\n                change: '+67.8%',\n                risk: 'ä¸­é£é™©',\n                analysis: ['ğŸ”¥ ä»·æ ¼å¤§å¹…ä¸Šæ¶¨', 'ğŸ“Š é«˜æµåŠ¨æ€§']\n            },\n            {\n                name: 'MetaWorld Coin',\n                symbol: 'MWC',\n                price: '$0.0089',\n                change: '+234.5%',\n                risk: 'é«˜é£é™©',\n                analysis: ['ğŸ”¥ ä»·æ ¼å¤§å¹…ä¸Šæ¶¨', 'ğŸš€ æ–°å…´é¡¹ç›®']\n            }\n        ];\n\n        container.innerHTML = `\n            <div class=\"discovery-header\">\n                <h4>ğŸ” å‘ç°æ–°æœºä¼š (æ¨¡æ‹Ÿæ•°æ®)</h4>\n                <p>æ—©æœŸå‘ç°å…·æœ‰æ½œåŠ›çš„æŠ•èµ„æœºä¼š</p>\n            </div>\n            <div class=\"discovery-grid\">\n                ${mockCoins.map(coin => `\n                    <div class=\"discovery-card mock\">\n                        <div class=\"discovery-header-info\">\n                            <div class=\"discovery-icon-placeholder\">ğŸª™</div>\n                            <div class=\"discovery-info\">\n                                <div class=\"discovery-name\">${coin.name}</div>\n                                <div class=\"discovery-symbol\">${coin.symbol}</div>\n                            </div>\n                            <div class=\"risk-badge\" style=\"background: ${this.getRiskColor(coin.risk)}\">\n                                ${coin.risk}\n                            </div>\n                        </div>\n                        \n                        <div class=\"discovery-price\">\n                            <div class=\"current-price\">${coin.price}</div>\n                            <div class=\"price-change change-positive\">\n                                ğŸ“ˆ ${coin.change}\n                            </div>\n                        </div>\n                        \n                        <div class=\"discovery-analysis\">\n                            <div class=\"analysis-tags\">\n                                ${coin.analysis.map(tag => `<span class=\"analysis-tag\">${tag}</span>`).join('')}\n                            </div>\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            <div class=\"discovery-disclaimer\">\n                <p>âš ï¸ æŠ•èµ„æœ‰é£é™©ï¼Œå…¥å¸‚éœ€è°¨æ…</p>\n                <p>è¯·åšå¥½å……åˆ†çš„ç ”ç©¶å†è¿›è¡ŒæŠ•èµ„å†³ç­–</p>\n            </div>\n        `;\n    }\n\n    showDiscoveryError() {\n        const container = document.getElementById('new-coins-list');\n        container.innerHTML = '<p style=\"text-align: center; color: #f44336; padding: 40px;\">ğŸ” åŠ è½½æ–°å¸å‘ç°æ•°æ®å¤±è´¥</p>';\n    }\n\n    formatPrice(price) {\n        if (price < 0.01) {\n            return price.toFixed(6);\n        } else if (price < 1) {\n            return price.toFixed(4);\n        } else {\n            return price.toFixed(2);\n        }\n    }\n\n    formatMarketCap(marketCap) {\n        if (marketCap >= 1e9) {\n            return (marketCap / 1e9).toFixed(2) + 'B';\n        } else if (marketCap >= 1e6) {\n            return (marketCap / 1e6).toFixed(2) + 'M';\n        } else if (marketCap >= 1e3) {\n            return (marketCap / 1e3).toFixed(2) + 'K';\n        } else {\n            return marketCap.toString();\n        }\n    }\n}\n\n// åœ¨é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–\ndocument.addEventListener('DOMContentLoaded', () => {\n    window.coinDiscovery = new CoinDiscovery();\n});