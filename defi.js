class DeFiDashboard {\n    constructor() {\n        this.defiProtocols = [];\n        this.setupEventListeners();\n    }\n\n    setupEventListeners() {\n        // å¯ä»¥æ·»åŠ ç­›é€‰å™¨ã€æ’åºç­‰äº‹ä»¶ç›‘å¬\n    }\n\n    async loadDefiData() {\n        try {\n            // åŠ è½½DeFiå…¨å±€æ•°æ®\n            await this.loadGlobalDefiData();\n            \n            // åŠ è½½DeFiåè®®æ•°æ®\n            await this.loadDefiProtocols();\n            \n        } catch (error) {\n            console.error('åŠ è½½DeFiæ•°æ®å¤±è´¥:', error);\n            this.showDefiError();\n        }\n    }\n\n    async loadGlobalDefiData() {\n        try {\n            const response = await fetch('https://api.coingecko.com/api/v3/global/decentralized_finance_defi');\n            \n            if (!response.ok) {\n                throw new Error('Failed to fetch DeFi global data');\n            }\n\n            const data = await response.json();\n            this.renderGlobalDefiStats(data.data);\n            \n        } catch (error) {\n            console.error('åŠ è½½DeFiå…¨å±€æ•°æ®å¤±è´¥:', error);\n            // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®\n            this.renderGlobalDefiStats({\n                defi_market_cap: '$180.5B',\n                defi_to_eth_ratio: '25.8%',\n                trading_volume_24h: '$4.2B'\n            });\n        }\n    }\n\n    async loadDefiProtocols() {\n        try {\n            // ä½¿ç”¨categories APIè·å–DeFiç›¸å…³ä»£å¸\n            const response = await fetch(\n                'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&category=decentralized-finance-defi&order=market_cap_desc&per_page=20&page=1&sparkline=false&price_change_percentage=24h'\n            );\n            \n            if (!response.ok) {\n                throw new Error('Failed to fetch DeFi protocols');\n            }\n\n            const protocols = await response.json();\n            this.renderDefiProtocols(protocols);\n            \n        } catch (error) {\n            console.error('åŠ è½½DeFiåè®®æ•°æ®å¤±è´¥:', error);\n            this.renderMockDefiProtocols();\n        }\n    }\n\n    renderGlobalDefiStats(data) {\n        const tvlElement = document.getElementById('defi-tvl');\n        const dominanceElement = document.getElementById('defi-dominance');\n\n        if (typeof data.defi_market_cap === 'object') {\n            tvlElement.textContent = this.formatMarketCap(data.defi_market_cap.usd);\n        } else {\n            tvlElement.textContent = data.defi_market_cap || '$180.5B';\n        }\n\n        if (data.defi_to_eth_ratio) {\n            dominanceElement.textContent = data.defi_to_eth_ratio.toFixed(1) + '%';\n        } else {\n            dominanceElement.textContent = data.defi_to_eth_ratio || '25.8%';\n        }\n    }\n\n    renderDefiProtocols(protocols) {\n        const container = document.getElementById('defi-protocols');\n        container.innerHTML = '';\n\n        // åˆ›å»ºè¡¨å¤´\n        const header = document.createElement('div');\n        header.className = 'defi-header';\n        header.innerHTML = `\n            <h4>ğŸ›ï¸ DeFiåè®®æ’è¡Œ</h4>\n            <p>æŒ‰å¸‚å€¼æ’åºçš„ä¸»è¦DeFiä»£å¸</p>\n        `;\n        container.appendChild(header);\n\n        // åˆ›å»ºåè®®åˆ—è¡¨\n        const protocolList = document.createElement('div');\n        protocolList.className = 'protocol-list';\n\n        protocols.slice(0, 10).forEach((protocol, index) => {\n            const protocolCard = this.createProtocolCard(protocol, index + 1);\n            protocolList.appendChild(protocolCard);\n        });\n\n        container.appendChild(protocolList);\n    }\n\n    createProtocolCard(protocol, rank) {\n        const card = document.createElement('div');\n        card.className = 'protocol-card';\n        \n        const priceChange = protocol.price_change_percentage_24h || 0;\n        const changeClass = priceChange >= 0 ? 'change-positive' : 'change-negative';\n        const changeIcon = priceChange >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰';\n        \n        card.innerHTML = `\n            <div class=\"protocol-rank\">#{rank}</div>\n            <div class=\"protocol-info\">\n                <img src=\"${protocol.image}\" alt=\"${protocol.name}\" class=\"protocol-icon\">\n                <div class=\"protocol-details\">\n                    <div class=\"protocol-name\">${protocol.name}</div>\n                    <div class=\"protocol-symbol\">${protocol.symbol.toUpperCase()}</div>\n                </div>\n            </div>\n            <div class=\"protocol-price\">\n                <div class=\"current-price\">$${this.formatPrice(protocol.current_price)}</div>\n                <div class=\"price-change ${changeClass}\">\n                    ${changeIcon} ${priceChange.toFixed(2)}%\n                </div>\n            </div>\n            <div class=\"protocol-stats\">\n                <div class=\"market-cap\">\n                    <span class=\"label\">å¸‚å€¼</span>\n                    <span class=\"value\">$${this.formatMarketCap(protocol.market_cap)}</span>\n                </div>\n                <div class=\"volume\">\n                    <span class=\"label\">24hæˆäº¤é‡</span>\n                    <span class=\"value\">$${this.formatMarketCap(protocol.total_volume)}</span>\n                </div>\n            </div>\n        `;\n        \n        return card;\n    }\n\n    renderMockDefiProtocols() {\n        const container = document.getElementById('defi-protocols');\n        const mockProtocols = [\n            { name: 'Uniswap', symbol: 'UNI', price: '$8.45', change: '+2.3%', marketCap: '$5.1B' },\n            { name: 'Chainlink', symbol: 'LINK', price: '$14.62', change: '+1.8%', marketCap: '$8.2B' },\n            { name: 'Aave', symbol: 'AAVE', price: '$95.30', change: '-0.5%', marketCap: '$1.4B' },\n            { name: 'Compound', symbol: 'COMP', price: '$52.18', change: '+3.2%', marketCap: '$320M' }\n        ];\n\n        container.innerHTML = `\n            <div class=\"defi-header\">\n                <h4>ğŸ›ï¸ DeFiåè®®æ’è¡Œ</h4>\n                <p>æ¨¡æ‹Ÿæ•°æ®å±•ç¤º</p>\n            </div>\n            <div class=\"protocol-list\">\n                ${mockProtocols.map((protocol, index) => `\n                    <div class=\"protocol-card mock\">\n                        <div class=\"protocol-rank\">#{index + 1}</div>\n                        <div class=\"protocol-info\">\n                            <div class=\"protocol-icon-placeholder\">ğŸ”·</div>\n                            <div class=\"protocol-details\">\n                                <div class=\"protocol-name\">${protocol.name}</div>\n                                <div class=\"protocol-symbol\">${protocol.symbol}</div>\n                            </div>\n                        </div>\n                        <div class=\"protocol-price\">\n                            <div class=\"current-price\">${protocol.price}</div>\n                            <div class=\"price-change ${protocol.change.includes('+') ? 'change-positive' : 'change-negative'}\">\n                                ${protocol.change.includes('+') ? 'ğŸ“ˆ' : 'ğŸ“‰'} ${protocol.change}\n                            </div>\n                        </div>\n                        <div class=\"protocol-stats\">\n                            <div class=\"market-cap\">\n                                <span class=\"label\">å¸‚å€¼</span>\n                                <span class=\"value\">${protocol.marketCap}</span>\n                            </div>\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n        `;\n    }\n\n    showDefiError() {\n        const container = document.getElementById('defi-protocols');\n        container.innerHTML = '<p style=\"text-align: center; color: #f44336; padding: 40px;\">ğŸ›ï¸ åŠ è½½DeFiæ•°æ®å¤±è´¥</p>';\n        \n        document.getElementById('defi-tvl').textContent = 'é”™è¯¯';\n        document.getElementById('defi-dominance').textContent = 'é”™è¯¯';\n    }\n\n    formatPrice(price) {\n        if (price < 1) {\n            return price.toFixed(6);\n        } else if (price < 100) {\n            return price.toFixed(4);\n        } else {\n            return price.toLocaleString('en-US', {\n                minimumFractionDigits: 2,\n                maximumFractionDigits: 2\n            });\n        }\n    }\n\n    formatMarketCap(marketCap) {\n        if (marketCap >= 1e12) {\n            return (marketCap / 1e12).toFixed(2) + 'T';\n        } else if (marketCap >= 1e9) {\n            return (marketCap / 1e9).toFixed(2) + 'B';\n        } else if (marketCap >= 1e6) {\n            return (marketCap / 1e6).toFixed(2) + 'M';\n        } else {\n            return marketCap.toLocaleString();\n        }\n    }\n}\n\n// åœ¨é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–\ndocument.addEventListener('DOMContentLoaded', () => {\n    window.defiDashboard = new DeFiDashboard();\n});